---
title: "15 Insights from Florida School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{15 Insights from Florida School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5,
  cache = TRUE
)
```

```{r load-packages}
library(flschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)

theme_set(theme_minimal(base_size = 14))
```

This vignette explores Florida's public school enrollment data, surfacing key trends and demographic patterns across recent years (2015-2024).

---

## 1. Florida is America's fourth-largest school system

Florida public schools serve nearly 3 million students, trailing only California, Texas, and New York.

```{r statewide-trend}
enr <- fetch_enr_multi(2015:2024, use_cache = TRUE)

state_totals <- enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 2))

state_totals
```

```{r statewide-chart}
ggplot(state_totals, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#FF6600") +
  geom_point(size = 3, color = "#FF6600") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Florida Public School Enrollment (2015-2024)",
    subtitle = "Nearly 3 million students in the Sunshine State",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

---

## 2. Miami-Dade is larger than most states

Miami-Dade County Public Schools, with 340,000+ students, is the fourth-largest school district in America.

```{r top-districts}
enr_2024 <- fetch_enr(2024, use_cache = TRUE)

top_10 <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(desc(n_students)) |>
  head(10) |>
  select(district_name, n_students)

top_10
```

```{r top-districts-chart}
top_10 |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name)) +
  geom_col(fill = "#FF6600") +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Florida's 10 Largest School Districts (2024)",
    x = "Total Enrollment",
    y = NULL
  )
```

---

## 3. COVID barely dented Florida enrollment

While other states saw sharp declines, Florida's enrollment dipped only briefly in 2021 and has since rebounded.

```{r covid-impact}
covid <- enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL",
         end_year >= 2019) |>
  select(end_year, n_students) |>
  mutate(change = n_students - lag(n_students))

covid
```

---

## 4. Hispanic students are the plurality

Hispanic students now comprise over 35% of Florida enrollment, surpassing white students.

```{r demographics}
demographics <- enr_2024 |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("hispanic", "white", "black", "asian", "multiracial")) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(subgroup, n_students, pct) |>
  arrange(desc(n_students))

demographics
```

```{r demographics-chart}
demographics |>
  mutate(subgroup = forcats::fct_reorder(subgroup, n_students)) |>
  ggplot(aes(x = n_students, y = subgroup, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Florida Student Demographics (2024)",
    subtitle = "Hispanic students are now the plurality",
    x = "Number of Students",
    y = NULL
  )
```

---

## 5. Central Florida is the growth engine

Orange, Osceola, and Polk counties have been among the fastest-growing, driven by the Orlando metro boom.

```{r central-florida}
central_fl <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Orange|Osceola|Polk", district_name),
         end_year %in% c(2015, 2024)) |>
  group_by(district_name) |>
  summarize(
    y2015 = n_students[end_year == 2015],
    y2024 = n_students[end_year == 2024],
    pct_change = round((y2024 / y2015 - 1) * 100, 1),
    .groups = "drop"
  ) |>
  arrange(desc(pct_change))

central_fl
```

---

## 6. Broward and Miami-Dade are declining

South Florida's two largest districts have been losing students as families relocate.

```{r south-florida}
south_fl <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Broward|Miami-Dade", district_name),
         end_year >= 2018) |>
  select(end_year, district_name, n_students) |>
  pivot_wider(names_from = district_name, values_from = n_students)

south_fl
```

```{r south-florida-chart}
enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Broward|Miami-Dade", district_name),
         end_year >= 2018) |>
  ggplot(aes(x = end_year, y = n_students, color = district_name)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "South Florida's Enrollment Decline",
    x = "School Year",
    y = "Enrollment",
    color = "District"
  )
```

---

## 7. Florida Virtual School is a district unto itself

Florida Virtual School (FLVS) serves tens of thousands of students statewide.

```{r virtual}
virtual <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Virtual|FLVS", district_name, ignore.case = TRUE)) |>
  select(district_name, n_students)

virtual
```

```{r virtual-chart}
# Show virtual school compared to other mid-sized districts
virtual_comparison <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  mutate(is_virtual = grepl("Virtual|FLVS", district_name, ignore.case = TRUE)) |>
  arrange(desc(n_students)) |>
  filter(row_number() <= 15 | is_virtual) |>
  select(district_name, n_students, is_virtual)

virtual_comparison |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name, fill = is_virtual)) +
  geom_col() +
  scale_x_continuous(labels = scales::comma) +
  scale_fill_manual(values = c("FALSE" = "#CCCCCC", "TRUE" = "#FF6600"),
                    labels = c("Traditional", "Virtual"),
                    name = "District Type") +
  labs(
    title = "Florida Virtual School Among Largest Districts (2024)",
    subtitle = "FLVS highlighted in orange",
    x = "Total Enrollment",
    y = NULL
  )
```

---

## 8. Kindergarten is the leading indicator

Florida kindergarten enrollment has been relatively stable, unlike states with sharp K declines.

```{r kindergarten}
k_trend <- enr |>
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("K", "01", "05", "09"),
         end_year >= 2019) |>
  select(end_year, grade_level, n_students) |>
  pivot_wider(names_from = grade_level, values_from = n_students)

k_trend
```

---

## 9. Black students are 22% of enrollment

Florida has a significant Black student population, concentrated in South Florida and the Jacksonville region.

```{r black-enrollment}
black_enr <- enr_2024 |>
  filter(is_state, grade_level == "TOTAL", subgroup == "black") |>
  select(subgroup, n_students, pct)

black_enr
```

---

## 10. Florida's county-based system is unique

Florida organizes schools by county, with 67 county districts (plus a few specialty districts). This structure differs from most states.

```{r county-count}
county_count <- enr_2024 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  summarize(
    n_districts = n_distinct(district_name),
    total_students = sum(n_students, na.rm = TRUE)
  )

county_count
```

---

## 11. Tampa Bay is catching up to South Florida

Hillsborough and Pinellas counties represent Florida's other major metro area. While South Florida declines, Tampa Bay has held steady.

```{r tampa-bay}
tampa <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Hillsborough|Pinellas|Pasco", district_name)) |>
  group_by(district_name) |>
  summarize(
    y2015 = n_students[end_year == 2015],
    y2024 = n_students[end_year == 2024],
    pct_change = round((y2024 / y2015 - 1) * 100, 1),
    .groups = "drop"
  ) |>
  arrange(desc(y2024))

tampa
```

```{r tampa-bay-chart}
enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Hillsborough|Pinellas|Pasco", district_name)) |>
  ggplot(aes(x = end_year, y = n_students, color = district_name)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  scale_color_brewer(palette = "Set1") +
  labs(
    title = "Tampa Bay Metro Enrollment Trends (2015-2024)",
    subtitle = "Hillsborough stable, Pasco growing, Pinellas declining",
    x = "School Year",
    y = "Enrollment",
    color = "County"
  )
```

---

## 12. Jacksonville is Florida's hidden giant

Duval County (Jacksonville) often flies under the radar, but it's Florida's 6th largest district with over 125,000 students.

```{r jacksonville}
jax <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Duval", district_name)) |>
  select(end_year, district_name, n_students) |>
  mutate(change = n_students - lag(n_students))

jax
```

```{r jacksonville-chart}
jax |>
  ggplot(aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#0066CC") +
  geom_point(size = 3, color = "#0066CC") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Duval County (Jacksonville) Enrollment (2015-2024)",
    subtitle = "Florida's 6th largest district",
    x = "School Year",
    y = "Total Enrollment"
  )
```

---

## 13. Hispanic enrollment surpassed White for the first time

A demographic milestone: Hispanic student enrollment has overtaken White enrollment in Florida, reflecting broader population shifts.

```{r hispanic-white-crossover}
crossover <- enr |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("hispanic", "white")) |>
  select(end_year, subgroup, n_students) |>
  pivot_wider(names_from = subgroup, values_from = n_students)

crossover
```

```{r hispanic-white-crossover-chart}
enr |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("hispanic", "white")) |>
  ggplot(aes(x = end_year, y = n_students, color = subgroup)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(values = c("hispanic" = "#FF6600", "white" = "#3399CC"),
                     labels = c("Hispanic", "White")) +
  labs(
    title = "The Hispanic-White Enrollment Crossover",
    subtitle = "Hispanic students now outnumber White students in Florida",
    x = "School Year",
    y = "Number of Students",
    color = "Group"
  )
```

---

## 14. Small rural counties face steep declines

While large metros grow, many of Florida's smallest counties are losing students rapidly.

```{r rural-decline}
# Get the first and last year for comparison
first_year <- min(enr$end_year)
last_year <- max(enr$end_year)

county_change <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         end_year %in% c(first_year, last_year)) |>
  group_by(district_name) |>
  filter(n() == 2) |>  # Only counties with both years
  summarize(
    y_first = n_students[end_year == first_year],
    y_last = n_students[end_year == last_year],
    change = y_last - y_first,
    pct_change = round((y_last / y_first - 1) * 100, 1),
    .groups = "drop"
  )

# Counties losing the most (by %)
declining <- county_change |>
  filter(y_first > 1000) |>  # Exclude tiny counties
  arrange(pct_change) |>
  head(10)

declining
```

```{r rural-decline-chart}
declining |>
  mutate(district_name = forcats::fct_reorder(district_name, pct_change)) |>
  ggplot(aes(x = pct_change, y = district_name)) +
  geom_col(fill = "#CC3333") +
  labs(
    title = paste0("Florida's Fastest Declining Counties (", first_year, "-", last_year, ")"),
    subtitle = "Percent change in total enrollment",
    x = "Percent Change",
    y = NULL
  )
```

---

## 15. Multiracial students are the fastest-growing demographic

While Hispanic students are the largest group, multiracial student enrollment has grown at the highest rate percentage-wise since 2015 (34.9% growth, compared to 26.1% for Hispanic students and 15.3% for Asian students).

```{r multiracial-growth}
demo_trend <- enr |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("hispanic", "white", "black", "asian", "multiracial")) |>
  select(end_year, subgroup, n_students) |>
  group_by(subgroup) |>
  mutate(pct_change = round((n_students / first(n_students) - 1) * 100, 1)) |>
  ungroup()

demo_trend |>
  filter(end_year == 2024) |>
  arrange(desc(pct_change))
```

```{r multiracial-growth-chart}
demo_trend |>
  ggplot(aes(x = end_year, y = pct_change, color = subgroup)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
  scale_color_brewer(palette = "Set1") +
  labs(
    title = "Demographic Growth Trends (2015-2024)",
    subtitle = "Percent change from 2015 baseline",
    x = "School Year",
    y = "Percent Change from 2015",
    color = "Subgroup"
  )
```

---

## Summary

Florida's school enrollment data reveals:

- **Continued growth**: Florida keeps growing while other major states decline
- **Demographic crossover**: Hispanic students now outnumber White students, Asian students growing fastest
- **Regional divergence**: Central Florida and Tampa Bay grow, South Florida and rural areas shrink
- **Virtual pioneer**: FLVS shows Florida's embrace of online education
- **County structure**: 67 county districts create a unique administrative system
- **Hidden giants**: Jacksonville (Duval) often overlooked as a major district

These patterns shape education policy across the Sunshine State.

---

*Data sourced from the Florida Department of Education.*

---

```{r session-info}
sessionInfo()
```
